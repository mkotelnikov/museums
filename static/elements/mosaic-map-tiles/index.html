<link rel="import" href="../../libs/polymer/polymer.html" />
<link rel="import" href="../leaflet.html">

<dom-module id="mosaic-map-tiles"> <script>
    (function() {
        Polymer({
            is : 'mosaic-map-tiles',
            properties : {
                leafletElement : {
                    type : Object,
                    notify : true
                },
                attribution : {
                    type : String,
                    notify : true,
                    observer : '_resetTiles'
                },
                tilesUrl : {
                    type : String,
                    notify : true,
                    observer : '_resetTiles'
                },
                utfgridUrl : {
                    type : String,
                    notify : true,
                    observer : '_resetUtfGrid'
                }
            },
            ready : function() {
                this.leafletElement = new L.featureGroup();
                this._resetTiles();
                this._resetUtfGrid();
                this.fire('leaflet-layer-added');
            },
            _resetTiles : function(url) {
                if (!this.leafletElement)
                    return;
                if (this._tiles) {
                    this.leafletElement.removeLayer(this._tiles);
                    delete this._tiles;
                }
                if (this.tilesUrl) {
                    var tiles = this._tiles = L.tileLayer(this.tilesUrl, {
                        attribution : this.attribution,
                    /* 
                     minZoom : minZoom,
                     maxZoom : maxZoom,
                     */
                    });
                    this.leafletElement.addLayer(tiles);
                }
            },
            _resetUtfGrid : function() {
                if (!this.leafletElement)
                    return;
                if (this._utfgrid) {
                    this.leafletElement.removeLayer(this._utfgrid);
                    delete this._utfgrid;
                }
                if (this.utfgridUrl) {
                    var utfGrid = new L.UtfGrid(this.utfgridUrl);
                    this.leafletElement.addLayer(utfGrid);
                    utfGrid.on('mouseover', function(ev) {
                        this.fire('mouseover', ev);
                    }, this)
                    utfGrid.on('click', function(ev) {
                        this.fire('click', ev);
                    }, this)
                }
            },
        });
    })();
</script> </dom-module>
